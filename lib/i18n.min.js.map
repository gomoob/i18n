{"version":3,"sources":["i18n.min.js"],"names":["root","factory","define","amd","$","Polyglot","Editor","exports","require","module","_","this","oldPrototype","prototype","options","opts","phrases","extend","currentLocale","locale","allowMissing","transformPhrase","onMissingKey","warn","message","console","urlBuilder","phrasesCache","currentType","type","currentVersion","version","cache","newType","newVersion","load","forceReload","replace","success","Error","ajax","dataType","url","proxy","data","textStatus","jqXHR","error","errorThrown"],"mappings":"CAAC,SAASA,EAAMC,GAEZ,GAAID,GAA0B,kBAAXE,SAAyBA,OAAOC,IAE/CD,QAAQ,SAAU,iBAAkB,SAASE,EAAGC,GAE5C,MAAQL,GAAKM,OAASL,EAAQD,EAAMI,EAAGC,SAM1C,IAAuB,mBAAZE,SAAyB,CAErC,GAAIH,GAAII,QAAQ,UACZH,EAAWG,QAAQ,gBAEvBC,QAAOF,QAAUN,EAAQD,EAAMI,EAAGC,OAIlCL,GAAKM,OAASL,EAAQD,EAAMA,EAAKU,EAAGV,EAAKK,WAE/CM,KAAM,SAASX,EAAMI,EAAGC,GAEtB,YAaA,IAAIO,GAAeP,EAASQ,SAwK5B,OAvKAR,GAAW,SAASS,GAGhB,GAAIC,GAAOD,KACXH,MAAKK,WACLL,KAAKM,OAAOF,EAAKC,aACjBL,KAAKO,cAAgBH,EAAKI,QAAU,IACpC,IAAIC,GAAeL,EAAKK,aAAeC,gBAAkB,IACzDV,MAAKW,aAA4C,kBAAtBP,GAAKO,aAA8BP,EAAKO,aAAeF,EAClFT,KAAKY,KAAOR,EAAKQ,MAAQ,SAASC,GAC9BC,QAAQF,KAAK,YAAcC,IAG/Bb,KAAKe,WAAaX,EAAKW,WAMvBf,KAAKgB,gBACLhB,KAAKiB,YAAeb,GAAQA,EAAKc,KAAQd,EAAKc,KAAO,cACrDlB,KAAKmB,eAAkBf,GAAQA,EAAKgB,QAAWhB,EAAKgB,QAAU,cAG9DpB,KAAKqB,MAAMrB,KAAKiB,YAAajB,KAAKO,cAAeP,KAAKmB,eAAgBnB,KAAKK,UAG/EX,EAASQ,UAAYD,EASrBP,EAASQ,UAAUgB,KAAO,SAASI,GAE/B,MADIA,KAAStB,KAAKiB,YAAcK,GACzBtB,KAAKiB,aAUhBvB,EAASQ,UAAUkB,QAAU,SAASG,GAElC,MADIA,KAAYvB,KAAKmB,eAAiBI,GAC/BvB,KAAKmB,gBAGhBzB,EAASQ,UAAUmB,MAAQ,SAASH,EAAMV,EAAQY,EAASf,GAEnDL,KAAKgB,aAAaE,KAClBlB,KAAKgB,aAAaE,OAGlBlB,KAAKgB,aAAaE,GAAMV,KACxBR,KAAKgB,aAAaE,GAAMV,OAG5BR,KAAKgB,aAAaE,GAAMV,GAAQY,GAAWf,GAc/CX,EAASQ,UAAUsB,KAAO,SAASrB,GAE/B,GAAIK,GAASL,EAAQK,QAAUR,KAAKO,cAChCW,EAAOf,EAAQe,MAAQlB,KAAKiB,YAC5BG,EAAUjB,EAAQiB,SAAWpB,KAAKmB,cAGtC,KAAIhB,EAAQsB,aAGLzB,KAAKgB,aAAaE,IAASlB,KAAKgB,aAAaE,GAAMV,GAIlD,GAAGY,IAAYpB,KAAKgB,aAAaE,GAAMV,GAAQY,SAGpCpB,MAAKgB,aAAaE,GAAMV,OAW/B,IAHAR,KAAK0B,QAAQ1B,KAAKgB,aAAaE,GAAMV,GAAQY,IAG1CjB,GAAWA,EAAQwB,QAIlB,WAFAxB,GAAQwB,QAAQ3B,KAAKgB,aAAaE,GAAMV,GAAQY,GAahE,KAAIpB,KAAKe,WACL,KAAM,IAAIa,OAAM,qCAQpBnC,GAAEoC,MAEMC,SAAW,OACXC,IAAM/B,KAAKe,WAAWZ,EAAQe,KAAMf,EAAQK,OAAQL,EAAQiB,SAC5DO,QAAUlC,EAAEuC,MACR,SAASC,EAAMC,EAAYC,GAGvBnC,KAAK0B,QAAQO,GAGbjC,KAAKqB,MAAMH,EAAMV,EAAQY,EAASa,GAG/B9B,GAAWA,EAAQwB,SAElBxB,EAAQwB,QAAQM,EAAMC,EAAYC,IAK1CnC,MAEJoC,MAAQ,SAASD,EAAOD,EAAYG,GAG7BlC,GAAWA,EAAQiC,OAElBjC,EAAQiC,MAAMD,EAAOD,EAAYG,OAU9C3C","file":"i18n.min.js","sourcesContent":["(function(root, factory) {\n    \n    if (root && typeof define === 'function' && define.amd) {\n        \n        define(['jquery', 'node-polyglot'], function($, Polyglot) {\n\n            return (root.Editor = factory(root, $, Polyglot));\n\n        });\n\n    }\n  \n    else if (typeof exports !== 'undefined') {\n\n        var $ = require('jquery');\n        var Polyglot = require('node-polyglot');\n        \n        module.exports = factory(root, $, Polyglot);\n\n    }\n    else {\n        root.Editor = factory(root, root._, root.Polyglot);\n    }\n}(this, function(root, $, Polyglot) {\n\n    'use strict';\n\n    /**\n     * Overwrites the Polyglot.js constructor to be able to manage additional options.\n     * \n     * @param {Object} options Options used to configure Polyglot.js.\n     * @param {Object} options.phrases The dictionary which contains the translations.\n     * @param {Object} options.locale The locale associated to the translations.\n     * @param {Object} options.type An arbitrary string which defines the type of the translation dictionary, this can \n     *        then be used in the application to manage multiple dictionaries. For example we could define a specific \n     *        dictionary for sub-application or sub-modules. \n     * @param {Function) options.urlBuilder A callback function used to build URLs where to load the translation files.\n     */\n    var oldPrototype = Polyglot.prototype;\n    Polyglot = function(options) {\n    \n        // Same code as the standard Polyglot constructor\n        var opts = options || {};\n        this.phrases = {};\n        this.extend(opts.phrases || {});\n        this.currentLocale = opts.locale || 'en';\n        var allowMissing = opts.allowMissing ? transformPhrase : null;\n        this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n        this.warn = opts.warn || function(message) {\n            console.warn('WARNING: ' + message);\n        };\n        \n        this.urlBuilder = opts.urlBuilder;\n\n        /**\n         * A cache used to cache translations on client side, this cache allows to not request the server each time the \n         * `load` method is called.\n         */\n        this.phrasesCache = {};\n        this.currentType = (opts && opts.type) ? opts.type : '__default__';\n        this.currentVersion = (opts && opts.version) ? opts.version : '__default__';\n    \n        // Cache the first loaded translations\n        this.cache(this.currentType, this.currentLocale, this.currentVersion, this.phrases);\n    \n    };\n    Polyglot.prototype = oldPrototype;\n    \n    /**\n     * Get / set the type of the dictionary in use / to use.\n     * \n     * @param {String} newType The type of dictionary to use.\n     * \n     * @return {String} The type of dictionary in use.\n     */\n    Polyglot.prototype.type = function(newType) {\n        if (newType) this.currentType = newType;\n        return this.currentType;  \n    };\n    \n    /**\n     * Get / set the version of the dictionary in use / to use.\n     * \n     * @param {String} newVersion The version of dictionary to use.\n     * \n     * @return {String} The version of dictionary in use.\n     */\n    Polyglot.prototype.version = function(newVersion) {\n        if (newVersion) this.currentVersion = newVersion;\n        return this.currentVersion;  \n    };\n    \n    Polyglot.prototype.cache = function(type, locale, version, phrases) {\n    \n        if(!this.phrasesCache[type]) {\n            this.phrasesCache[type] = {};\n        }\n        \n        if(!this.phrasesCache[type][locale]) {\n            this.phrasesCache[type][locale] = {};\n        }\n        \n        this.phrasesCache[type][locale][version] = phrases;\n    \n    },\n    \n    /**\n     * Function used to load new translations from a JSON file.\n     * \n     * @param {Object} options Options used to configure the loading.\n     * @param {Object} options.type The type of dictionary to load.\n     * @param {Object} options.locale The locale associated to the disctionary to load.\n     * @param {Object} options.version The version of the dictionary to load.\n     * @param {Object} options.forceReload Boolean used to indicate if the function should by-pass the translations \n     *        cache and always reload the translations using an HTTP request.\n     */\n    Polyglot.prototype.load = function(options) {\n\n        var locale = options.locale || this.currentLocale,\n            type = options.type || this.currentType, \n            version = options.version || this.currentVersion;\n    \n        // If the 'forceReload' option is false we try to find the translations from the cache\n        if(!options.forceReload) {\n            \n            // If translations are available in the cache\n            if(this.phrasesCache[type] && this.phrasesCache[type][locale]) {\n    \n                // If a version is provided and this version is not the one used in the cache we have to request \n                // translations again\n                if(version && !this.phrasesCache[type][locale][version]) {\n    \n                    // Be sure we remove the translations from the cache\n                    delete this.phrasesCache[type][locale];\n    \n                } \n                \n                // Otherwise get the translations from the cache, call the 'success' method and exist\n                else {\n                    \n                    // Replace the translations in use\n                    this.replace(this.phrasesCache[type][locale][version]);\n    \n                    // If a 'success' method has been provided\n                    if(options && options.success) {\n    \n                        options.success(this.phrasesCache[type][locale][version]);\n                        \n                        return;\n                    \n                    }\n    \n                }\n    \n            }\n            \n        }\n        \n        // A URL builder must have been defined\n        if(!this.urlBuilder) {\n            throw new Error('No \\'urlBuilder\\' has been defined !');\n        }\n    \n        // We can be here if\n        //  - The 'forceReload' option is true\n        //  - No translations have been found in the cache\n        //  - Translations have been found in the cache but the associated version is not the same as the provided \n        //    version\n        $.ajax(\n            {\n                dataType : 'json',\n                url : this.urlBuilder(options.type, options.locale, options.version), \n                success : $.proxy(\n                    function(data, textStatus, jqXHR) {\n    \n                        // Replace the translations in use\n                        this.replace(data);\n                        \n                        // Updates the translations cache\n                        this.cache(type, locale, version, data);\n    \n                        // If a 'success' method has been provided\n                        if(options && options.success) {\n                            \n                            options.success(data, textStatus, jqXHR);\n                        \n                        }\n    \n                    },\n                    this\n                ),\n                error : function(jqXHR, textStatus, errorThrown) {\n                    \n                    // If an 'error' method has been provided\n                    if(options && options.error) {\n                        \n                        options.error(jqXHR, textStatus, errorThrown);\n                        \n                    }\n    \n                }\n            }\n        );\n        \n    };\n    \n    return Polyglot;\n\n}));\n"],"sourceRoot":"/source/"}